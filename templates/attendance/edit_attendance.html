{% extends 'base.html' %}
{% load static %}

{% block title %}উপস্থিতি সম্পাদনা - School Management System{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">উপস্থিতি সম্পাদনা করুন</h1>
    {% extends 'base.html' %}
    {% load static %}

    {% block title %}উপস্থিতি সম্পাদনা - School Management System{% endblock %}

    {% block content %}
    <div
        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">উপস্থিতি সম্পাদনা করুন</h1>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">উপস্থিতি তথ্য</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <p><strong>তারিখ:</strong> {{ attendance.date|date:"d M, Y" }}</p>
                </div>
                <div class="col-md-3">
                    <p><strong>শ্রেণী:</strong> {{ attendance.class_info.get_class_name_display }}</p>
                </div>
                <div class="col-md-3">
                    <p><strong>শাখা:</strong> {{ attendance.class_info.section }}</p>
                </div>
                <div class="col-md-3">
                    <p><strong>বিষয়:</strong> {{ attendance.subject.get_name_display }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h5 class="card-title mb-0">শিক্ষার্থীদের উপস্থিতি সম্পাদনা করুন</h5>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th width="5%">#</th>
                                <th width="15%">রোল নং</th>
                                <th width="40%">নাম</th>
                                <th width="20%">স্ট্যাটাস</th>
                                <th width="20%">মন্তব্য</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for record in attendance_details %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ record.student.roll_number }}</td>
                                <td>{{ record.student.name }}</td>
                                <td>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio"
                                            name="status_{{ record.student.id }}" id="present_{{ record.student.id }}"
                                            value="present" {% if record.status=='present' %}checked{% endif %}>
                                        <label class="form-check-label"
                                            for="present_{{ record.student.id }}">উপস্থিত</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio"
                                            name="status_{{ record.student.id }}" id="absent_{{ record.student.id }}"
                                            value="absent" {% if record.status=='absent' %}checked{% endif %}>
                                        <label class="form-check-label"
                                            for="absent_{{ record.student.id }}">অনুপস্থিত</label>
                                    </div>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm"
                                        name="remarks_{{ record.student.id }}" value="{{ record.remarks|default:'' }}"
                                        placeholder="মন্তব্য (ঐচ্ছিক)">
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center">কোন উপস্থিতি রেকর্ড পাওয়া যায়নি</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% if attendance_details %}
                <div class="mt-3">
                    <button type="submit" class="btn btn-success">পরিবর্তনগুলি সংরক্ষণ করুন</button>
                    <a href="{% url 'attendance:attendance_detail' attendance.id %}" class="btn btn-secondary">বাতিল
                        করুন</a>
                </div>
                {% endif %}
            </form>
        </div>
    </div>
    {% endblock %}